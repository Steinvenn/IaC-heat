heat_template_version: 2013-05-23

description: >
  HOT template that invokes subtemplates

parameters:
  key_name:
    type: string
    description: Name of keypair to assign to servers
  image_linux:
    type: string
    description: Name of image to use for GNU/Linux servers
    default: Ubuntu Server 16.04 LTS (Xenial Xerus) amd64
  image_windows:
    type: string
    description: Name of image to use for Windows servers
    default: Windows Server 2016 Std Eval
  public_net:
    type: string
    description: >
      ID or name of public network for which floating IP addresses will be allocated
    default: ext-net
  sec_group_linux:
    type: comma_delimited_list
    description: Security groups
    default: default,linux
  sec_group_windows:
    type: comma_delimited_list
    description: Security groups
    default: default,windows

resources:

  iac_base:
    type: iac_base.yaml
    properties:
      key_name:          { get_param: key_name }
      image_linux:       { get_param: image_linux }  
      image_windows:     { get_param: image_windows }  
      public_net:        { get_param: public_net }  
      sec_group_linux:   { get_param: sec_group_linux }  
      sec_group_windows: { get_param: sec_group_windows }  

outputs:
  manager_admin_ip:
    description: IP address of manager in the admin network
    value: { get_attr: [iac_base,manager_admin_ip] }
  dir01_admin_ip:
    description: IP address of dir01 in the admin network
    value: { get_attr: [iac_base,dir01_admin_ip] }
  dir01_internal_ip:
    description: IP address of dir01 in the internal network
    value: { get_attr: [iac_base,dir01_internal_ip] }

